get_current_branch() {
    git rev-parse --abbrev-ref HEAD
}

commit_changes() {
    local this_branch=$(get_current_branch)
    
    if [ "$1" = "one" ]; then
        shift
        git commit -m "$this_branch" "$@"
    else
        git commit "$@"
    fi
}

pop_commit() {
  local reset_mode="--soft"
  local commit_count=1

  while [[ $# -gt 0 ]]; do
    case "$1" in
      -m)
        shift
        reset_mode="$1"
        ;;
      -n)
        shift
        commit_count="$1"
        ;;
      *)
        echo "Invalid argument: $1"
        return 1
        ;;
    esac
    shift
  done

  git reset "$reset_mode" "HEAD~$commit_count"
}

handle_commit() {
  case "$1" in
    pop)
      pop_commit "${@:2}"
      ;;
    *)

      # If no arguments, Call commit_changes with all arguments
      commit_changes "$@"
      ;;
  esac
}

push_changes() {
    local this_branch=$(get_current_branch)
    local force_push=""

    if [ "$1" = "-f" ]; then
        force_push="-f"
    fi

    git push origin $force_push "$this_branch" --no-verify
}

pull_changes() {
    local this_branch=$(get_current_branch)
    git pull origin "$this_branch"
}

print_this_branch() {
    local this_branch=$(get_current_branch)
    echo "Current branch: $this_branch"
}

branch_exists() {
    local branch_name="$1"
    if git show-ref --verify --quiet "refs/heads/$branch_name"; then
        return 0 # Branch exists
    else
        return 1 # Branch does not exist
    fi
}

handle_this_command() {
    case "$1" in
        b)
            print_this_branch
            ;;
        *)
            echo "Unknown command. Usage: mygit this [b]"
            ;;
    esac
}

handle_is_command() {
    case "$1" in
        b)
            shift
            branch_name="$1"
            if branch_exists "$branch_name"; then
                echo "true"
                return 0
            else
                echo "false"
                return 1
            fi
            ;;
        *)
            echo "Unknown command. Usage: mygit is b <branch_name>"
            ;;
    esac
}

add_or_delete_worktree() {
    if [ "$1" = "-a" ]; then
        shift
        branch_name="$1"
        shift
        worktree_path="$1"
        if branch_exists "$branch_name"; then
            git worktree add "$worktree_path" "$branch_name"
        else
            echo "Branch does not exist. Creating new branch '$branch_name'..."
            git worktree add "$worktree_path" -b "$branch_name"
        fi
    fi

    if [ "$1" = "-d" ]; then
        shift
        worktree_path="$1"
        if [ -d "$worktree_path" ]; then
            git worktree remove "$worktree_path"
        else
            echo "Worktree directory does not exist."
        fi
    fi

    if [ "$1" = "-df" ]; then
        shift
        worktree_path="$1"
        if [ -d "$worktree_path" ]; then
            git worktree remove -f "$worktree_path"
        else
            echo "Worktree directory does not exist."
        fi
    fi
}


mygit() {
    case "$1" in
        commit)
            handle_commit "${@:2}"
            ;;
        push)
            push_changes "${@:2}"
            ;;
        pull)
            pull_changes
            ;;
        status)
            git "$@"
            ;;
        this)
            shift
            handle_this_command "$@"
            ;;
        is)
            shift
            handle_is_command "$@"
            ;;
        wt)
            shift
            add_or_delete_worktree "$@"
            ;;
        *)
            echo "Unknown command. Usage: mygit [commit|push|pull|status|this|is|wt]"
            ;;
    esac
}